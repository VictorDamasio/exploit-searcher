#/bin/bash

echo "This script needs to be run as root, as it's writing to the opt directory. Be sure to have enough permissions if you wish to proceed";

var=$(which cve_searchsploit);

if [ -z "$var" ]
then
        echo "cve_searchsploit not found, would you like to install it? (y/n)";
        read;
        if [ "${REPLY}" == "n" ]
        then
                echo "Ok, then. Keep your secrets.";
                exit 0;
        fi
        if [ "${REPLY}" == "y" ]
        then
                git clone https://github.com/andreafioraldi/cve_searchsploit /opt/cve_searchsploit;
                cd /opt/cve_searchsploit;
                python3 setup.py install;
        fi
fi

echo "Reading scan file... this may take some time if the file is too large";

result="$(grep -P -i -o 'CVE-\d{4}-\d{4,7}' $1 | sort -u)";

echo "Generating results...";

while IFS= read -r i; do cve_searchsploit $i | grep -i "Exploit DB" -A 6 -B 4; done <<< "$result"
